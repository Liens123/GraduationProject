<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.graduation_project.mapper.LoginMapper">

    <!-- 字段映射 -->
    <!-- Maps columns from 'auth_user' table -->
    <resultMap id="BaseResultMap" type="org.example.graduation_project.model.AdminUser">
        <id property="id" column="id" jdbcType="BIGINT"/>           <!-- Changed jdbcType -->
        <result property="username" column="username" jdbcType="VARCHAR"/>
        <result property="name" column="name" jdbcType="VARCHAR"/>
        <result property="password" column="password" jdbcType="VARCHAR"/>
        <result property="status" column="status" jdbcType="TINYINT"/>     <!-- Changed jdbcType -->
        <result property="operator" column="operator" jdbcType="VARCHAR"/>
        <result property="createdTime" column="created_time" jdbcType="TIMESTAMP"/>
        <result property="updatedTime" column="updated_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- Select from the new table 'auth_user' -->
    <select id="findByUsername" resultMap="BaseResultMap" parameterType="String">
        SELECT id, username, name, password, status, operator, created_time, updated_time
        FROM auth_user <!-- Changed table name -->
        WHERE username = #{username, jdbcType=VARCHAR}
        LIMIT 1
    </select>

    <!-- Insert into the new table 'auth_user' -->
    <insert id="insert" parameterType="org.example.graduation_project.model.AdminUser">
        INSERT INTO auth_user <!-- Changed table name -->
        (username, name, password, status, operator, created_time, updated_time)
        VALUES
        (#{username, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{status, jdbcType=TINYINT},    <!-- Changed jdbcType -->
        #{operator, jdbcType=VARCHAR},
        #{createdTime, jdbcType=TIMESTAMP},
        #{updatedTime, jdbcType=TIMESTAMP})
    </insert>

    <!-- Generic update on the new table 'auth_user' (Use with caution) -->
    <update id="update" parameterType="org.example.graduation_project.model.AdminUser">
        UPDATE auth_user <!-- Changed table name -->
        SET
        username = #{username, jdbcType=VARCHAR},
        name = #{name, jdbcType=VARCHAR},
        password = #{password, jdbcType=VARCHAR}, /* Avoid password update here */
        status = #{status, jdbcType=TINYINT},     /* Changed jdbcType */
        operator = #{operator, jdbcType=VARCHAR},
        updated_time = #{updatedTime, jdbcType=TIMESTAMP}
        WHERE id = #{id, jdbcType=BIGINT}              /* Changed jdbcType */
    </update>

    <!-- Specific password update on the new table 'auth_user' -->
    <!-- Removed parameterType="map" as it's inferred from @Param in interface -->
    <update id="updatePasswordByID">
        UPDATE auth_user <!-- Changed table name -->
        SET
        password = #{encodedPassword, jdbcType=VARCHAR},
        updated_time = #{updatedTime, jdbcType=TIMESTAMP}
        WHERE id = #{id, jdbcType=BIGINT}                  /* Changed jdbcType */
    </update>

</mapper>